node {

notify('Started')

try {

 // Get Artifactory server instance, defined in the Artifactory Plugin administration page.
    def server = Artifactory.server "jfrog-server"
    def buildInfo = Artifactory.newBuildInfo() 

  stage('GitCheckOut') {
	git branch: 'staging',url: 'https://github.com/akyhcs/1-22-2021_devops.git'
	sh "mkdir -p Downloads/files"
}
 
// Project Dir
    def project_path = "Downloads"

dir(project_path){

stage('Build Managment') {
      def uploadSpec = """{
	 "files": [
	{
	  "pattern": "devops_301_/*.war",
          "target": "files/"
        }
	]
	}"""
	server.download spec: uploadSpec
 }


stage('Publish build info') {
  server.publishBuildInfo buildInfo
}

stage('Deployment - PreProd') {
  sh 'docker-compose up -d --build'
 }
  notify('Completed')
} }catch(err){
  notify("Error ${err}")
  currentBuild.result = 'FAILURE'
 }
}
def notify(arg)
{
	
}
